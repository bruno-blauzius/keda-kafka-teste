# Pre-commit hooks para validação de manifests Kubernetes
repos:
# YAML Linting
- repo: https://github.com/adrienverge/yamllint
  rev: v1.35.1
  hooks:
  - id: yamllint
    name: Lint YAML files
    args: [ '-c', '.yamllint.yaml', '.' ]
    pass_filenames: false

# Kubernetes Schema Validation with Kubeconform
- repo: local
  hooks:
  - id: kubeconform
    name: Validate Kubernetes manifests with kubeconform
    entry: wsl bash -c 'kubeconform -strict -ignore-missing-schemas deployment.yaml namespace.yaml secret.yaml service.yaml poddisruptionbudget.yaml networkpolicy.yaml networkpolicy-block-http-https.yaml triggerauthentication.yaml serviceaccount.yaml keda-scaledobject.yaml || true'
    language: system
    always_run: true
    pass_filenames: false

# Kustomize Validation
- repo: local
  hooks:
  - id: kustomize-validate
    name: Validate Kustomize configuration
    entry: wsl bash -c 'kubectl kustomize . > /dev/null || true'
    language: system
    files: kustomization\.yaml$
    pass_filenames: false

# Security Scan with Trivy
- repo: local
  hooks:
  - id: trivy-config
    name: Security scan with Trivy
    entry: wsl bash -c 'trivy config --config trivy.yaml . --exit-code 0'
    language: system
    always_run: true
    pass_filenames: false

# Security and best practices with kube-score
- repo: local
  hooks:
  - id: kube-score
    name: Kubernetes best practices with kube-score
    entry: wsl bash -c 'kube-score score deployment.yaml namespace.yaml secret.yaml service.yaml poddisruptionbudget.yaml networkpolicy.yaml networkpolicy-block-http-https.yaml triggerauthentication.yaml serviceaccount.yaml keda-scaledobject.yaml --output-format ci --ignore-test deployment-has-host-podantiaffinity --ignore-test deployment-targeted-by-hpa-does-not-have-replicas-specified --ignore-test deployment-has-poddisruptionbudget --ignore-test pod-networkpolicy --ignore-test container-security-context-user-group-id --ignore-test networkpolicy-targets-pod || true'
    language: system
    always_run: true
    pass_filenames: false

# Secret detection
- repo: https://github.com/gitleaks/gitleaks
  rev: v8.18.1
  hooks:
  - id: gitleaks
    name: Detect secrets with gitleaks

# Markdown linting (for documentation)
- repo: https://github.com/igorshubovych/markdownlint-cli
  rev: v0.38.0
  hooks:
  - id: markdownlint
    name: Lint Markdown files
    args: [ '--fix' ]
